import React, { useEffect, useState } from "react";
import { collection, getDocs } from 'firebase/firestore';
import { db, storage } from '../firebase-config';
import {ref as storageRef,getDownloadURL, listAll} from 'firebase/storage';
import 'font-awesome/css/font-awesome.min.css';


export function Home() {

    const [isClicked, setIsClicked] = useState(false);
    const [grayness, setGrayness] = useState(15); 
    const [blurness, setBlurness] = useState(10);
    const [hoveredPostId, setHoveredPostId] = useState(null);
    const [audio, setAudio] = useState(new Audio());
    const [isRotating, setIsRotating] = useState(false);

    const handleClick = () => {
      if (grayness >= 200) {setGrayness(0)}  
      setGrayness((prevGrayness) => prevGrayness + 20);
      setIsClicked((prevState) => !prevState);
      console.log(grayness);
      playRandomMusic();

      // Iniciar a animação de rotação quando a música começa
      setIsRotating(true);
    };

    const handleMouseEnter = () => {
          setBlurness(0); // Define o desfoque como 0 quando o mouse entra, mas apenas se não estiver clicado
      };
    
    const handleMouseLeave = () => {
          setBlurness(10); // Define o desfoque como 10 quando o mouse sai, mas apenas se não estiver clicado
          pauseMusic();
      };

      const playRandomMusic = async () => {
        try {
          const musicRef = storageRef(storage, 'music'); // Substitua 'music' com o caminho correto para as músicas no seu Firebase Storage
          const musicList = await listAll(musicRef);
          const musicArray = [];
          musicList.items.forEach(async (itemRef) => {
            const musicUrl = await getDownloadURL(itemRef);
            musicArray.push(musicUrl);
          });
      
          const randomIndex = Math.floor(Math.random() * musicArray.length);
          const musicUrl = musicArray[randomIndex];
      
          audio.src = musicUrl;
          audio.play();
        } catch (error) {
          console.error("Erro ao reproduzir música: ", error);
        }
      };
    
      const pauseMusic = () => {
        audio.pause();
    
        // Parar a animação de rotação quando a música para
        setIsRotating(false);
      };

      //----------------------- GET POSTS -----------------------------------------------------//

    
      
   const [postList, setPostList] = useState([]);
   const postCollectionRef = collection(db, "posts");

    useEffect(() => {
       const getPosts = async () => {
           const data = await getDocs(postCollectionRef);
            setPostList(data.docs.map((doc) => ({ ...doc.data(), id: doc.id })));
        };
        getPosts();
    },[]);

    //--------------------------------------------------------------------------------------------//

    return (
        // FRIST STEP 1 - logo, 2 DADO, 3 TEXT -----  Slices --------- Contact and articles
        <div className="homePage">
          <div className="mainHome">
            <div
              className={`homeLogo ${isRotating ? "rotate-animation" : ""}`} 
              onMouseEnter={handleMouseEnter}
              onMouseLeave={handleMouseLeave}
              onClick={handleClick}
              style={{
                filter: `blur(${blurness}px) grayscale(${grayness}%)`,
                transition: "filter 1s ease-in-out",
              }}
            >
            </div>
            <div>
              <img src="/logo-512.svg" alt="Logo"/>
            </div>  
            <div className="dice"> <h4>Clique aqui!</h4> </div>
            <div className="hometext">
                <h1>Bem-vindo ao meu blog pessoal</h1>
                <h4>Sinta-se à vontade para explorar de sua maneira preferida.</h4>
                <h4>Me chamo Rodrigo Barenco e espero que goste da experiência.</h4>
            </div>
          </div> 
            


          <div className="homeSliceOne">
            <div className="hometext">
                <h1>Nem sempre sabemos o que esperar</h1>
                <h4>Você chegou aqui por um motivo. E espero que encontre outros para me contactar ou apenas acompanhar minha jornada.</h4>
                <h4>Já passei por muitas áreas do conhecimento e para mim também foi uma surpresa...</h4>
            </div>
          </div>



          <div className="homeSliceTwo">
            <div className="hometext">
                <h1>As vezes mudamos de ideia mas nunca paramos</h1>
                <h4>Foi uma supresa que tenha finalmente achado meu caminho, pois nem sempre a vida segue em linha reta, as vezes precisamos mudar.</h4>
                <h4>Imagine que fiz automobilística, ciência política, um perído de engenha eletrotécnica, administração, história... não desisti de encontrar o que amo.</h4>
            </div>
          </div>



          <div className="homeSliceThree">
            <div className="hometext">
                <h1>Então... parece que encontrei</h1>
                <h4>E sim, também amo musica e sou trompetista nas horas vagas! Mas o lugar onde me sinto bem como profissional é na área de tecnologia.</h4>
                <h4>Hoje posso dizer em alto e bom som que amo o que faço!</h4>
            </div> 
          </div>



          <div className="homeSliceFour">
            <div className="hometext">
                <h1>Se você chegou até aqui</h1>
                <h4>Eu realmente agradeço. Como você pode observar, embaixo estão alguns de meus artigos e também meus contatos.</h4>
                <h4>Não seja tímido! Você pode me seguir, mandar uma menssagem, pode ter ceteza que irei responder.</h4>
            </div> 
          </div>



          <div className="ContactArticles">

              <div className="hometext">
                <h1>Contato</h1>
                <h4>Caso tenha alguma dúvida ou queira fazer contato profissional, <br/>utilize uma das seguintes opções:</h4>
                <div className="buttonHomeContainer">
                <button className="yellowbutton"> CONTATO </button>
                <a href="https://www.linkedin.com/in/rodrigobarenco/" target="_blank">
                <i className="fa fa-linkedin fa-2x"></i>
                </a>
                <a href="https://www.linkedin.com/in/rodrigobarenco/" target="_blank">
                <i className="fa fa-github fa-2x"></i>
                </a>
                </div>
              </div>   

           <div className="postContainerAndTitle">
              <h1>ARTIGOS</h1> 
              <div className="postsHome">
                {postList.map((post) => {

                 function styleHandlerIn() {
                   setHoveredPostId(post.id)
                  console.log(post.color)
                 }

                 function styleHandlerOut() {
                   setHoveredPostId(null)
                 }

                   return (
                     <div className="post" 
                     key={post.id}
                     onMouseEnter={() => styleHandlerIn()}
                     onMouseLeave={() => styleHandlerOut()}
                     style={{
                       filter: `drop-shadow(0 -0.3mm 1mm ${
                         hoveredPostId === post.id ? post.color : 'transparent'
                       })`,
                       transition: "filter 1.8s ease-in-out",
                     }}
                     >
                       {""}
                       <div className="postHeader">
                         {""}
                         <div className="title">
                         {""}
                         <h2>{post.title}</h2>
                         </div>

                         <div className="content">
                         {""}
                         <h4>{post.content}</h4>
                      </div>
                    </div>
                  </div>
                )
              })
             }
             </div>
            </div>
          </div>
        </div>
      );
}

export default Home;